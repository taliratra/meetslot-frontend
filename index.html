<!DOCTYPE html>
<html lang="ru">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>MEET SLOT - Ğ ÑƒĞ»ĞµÑ‚ĞºĞ° ĞŸÑ€Ğ¸Ğ·Ğ¾Ğ²</title>
Â  Â  Â  Â  <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* ĞĞ±Ñ‰Ğ¸Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ¸ ÑˆÑ€Ğ¸Ñ„Ñ‚ */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Arial', sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  background: #f0f4f8; /* Ğ¡Ğ²ĞµÑ‚Ğ»Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ */
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  }

Â  Â  Â  Â  .app-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 400px; /* ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… */
Â  Â  Â  Â  Â  Â  background: #ffffff;
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #007bff;
Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ñ€ÑƒĞ»ĞµÑ‚ĞºĞ¸ --- */
Â  Â  Â  Â  .wheel-container {
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  width: 300px;
Â  Â  Â  Â  Â  Â  height: 300px;
Â  Â  Â  Â  Â  Â  margin: 0 auto 30px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .wheel {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  background: #e9ecef; /* Ğ¤Ğ¾Ğ½ ĞºĞ¾Ğ»ĞµÑĞ° */
Â  Â  Â  Â  Â  Â  border: 8px solid #007bff;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  transition: transform 0s; /* Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğµ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ° */
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .sector {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  width: 50%;
Â  Â  Â  Â  Â  Â  height: 50%;
Â  Â  Â  Â  Â  Â  transform-origin: 0 100%;
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  padding-top: 50%;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  font-size: 10px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  line-height: 1.1;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .sector-text {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 10px; /* ĞÑ‚ÑÑ‚ÑƒĞ¿ Ğ¾Ñ‚ Ğ²Ğ½ĞµÑˆĞ½ĞµĞ³Ğ¾ ĞºÑ€Ğ°Ñ */
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  Â  Â  transform: rotate(90deg) translate(-50%, 0);
Â  Â  Â  Â  Â  Â  transform-origin: 0 0;
Â  Â  Â  Â  Â  Â  white-space: normal;
Â  Â  Â  Â  }

Â  Â  Â  Â  .center-button {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: 50%;
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 100px;
Â  Â  Â  Â  Â  Â  height: 100px;
Â  Â  Â  Â  Â  Â  background: #ff5722;
Â  Â  Â  Â  Â  Â  border-radius: 50%;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  font-size: 20px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 5px white, 0 0 0 7px #ff5722;
Â  Â  Â  Â  Â  Â  pointer-events: none; /* ĞĞµ Ñ€ĞµĞ°Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ° ĞºĞ»Ğ¸ĞºĞ¸ */
Â  Â  Â  Â  }

Â  Â  Â  Â  .pointer {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  top: -10px;Â 
Â  Â  Â  Â  Â  Â  left: 50%;
Â  Â  Â  Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  Â  Â  Â  width: 0;
Â  Â  Â  Â  Â  Â  height: 0;
Â  Â  Â  Â  Â  Â  border-left: 10px solid transparent;
Â  Â  Â  Â  Â  Â  border-right: 10px solid transparent;
Â  Â  Â  Â  Â  Â  border-top: 20px solid #ff5722; /* ĞšÑ€Ğ°ÑĞ½Ğ°Ñ ÑÑ‚Ñ€ĞµĞ»ĞºĞ° */
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞ¿Ğ¸Ğ½Ğ° --- */
Â  Â  Â  Â  .spin-button {
Â  Â  Â  Â  Â  Â  background: linear-gradient(145deg, #007bff, #0056b3);
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 15px 30px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 15px rgba(0, 123, 255, 0.4);
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 300px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .spin-button:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background: linear-gradient(145deg, #0056b3, #007bff);
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 20px rgba(0, 123, 255, 0.6);
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  }

Â  Â  Â  Â  .spin-button:disabled {
Â  Â  Â  Â  Â  Â  background: #adb5bd;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  Â  Â  box-shadow: none;
Â  Â  Â  Â  Â  Â  opacity: 0.7;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ --- */
Â  Â  Â  Â  .modal {
Â  Â  Â  Â  Â  Â  display: none; /* Ğ¡ĞºÑ€Ñ‹Ñ‚Ğ¾ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ */
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  z-index: 100;Â 
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow: auto;
Â  Â  Â  Â  Â  Â  background-color: rgba(0,0,0,0.4); /* ĞŸĞ¾Ğ»ÑƒĞ¿Ñ€Ğ¾Ğ·Ñ€Ğ°Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ */
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background-color: #fefefe;
Â  Â  Â  Â  Â  Â  margin: 15% auto; /* Ğ¦ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ */
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  width: 80%;Â 
Â  Â  Â  Â  Â  Â  max-width: 350px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
Â  Â  Â  Â  Â  Â  animation: fadeIn 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes fadeIn {
Â  Â  Â  Â  Â  Â  from { opacity: 0; transform: scale(0.9); }
Â  Â  Â  Â  Â  Â  to { opacity: 1; transform: scale(1); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-content button {
Â  Â  Â  Â  Â  Â  background: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  transition: background 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-content button:hover {
Â  Â  Â  Â  Â  Â  background: #1e7e34;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº --- */
Â  Â  Â  Â  #errorText {
Â  Â  Â  Â  Â  Â  display: none;
Â  Â  Â  Â  Â  Â  color: #dc3545;
Â  Â  Â  Â  Â  Â  background: #f8d7da;
Â  Â  Â  Â  Â  Â  border: 1px solid #f5c6cb;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  /* ĞĞ¾Ğ²Ñ‹Ğ¹ ÑÑ‚Ğ¸Ğ»ÑŒ Ğ´Ğ»Ñ ÑÑÑ‹Ğ»ĞºĞ¸ Ğ² Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ¾ĞºĞ½Ğµ */
Â  Â  Â  Â  .modal-link {
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  background: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  font-size: 16px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  Â  Â  Â  transition: background 0.3s;
Â  Â  Â  Â  }

Â  Â  Â  Â  .modal-link:hover {
Â  Â  Â  Â  Â  Â  background: #1e7e34;
Â  Â  Â  Â  }

Â  Â  </style>
</head>
<body>
<div class="app-container">
Â  Â  <h1>Ğ ÑƒĞ»ĞµÑ‚ĞºĞ° MeetSlot ğŸ</h1>

Â  Â  <div id="errorText"></div>

Â  Â  <div class="wheel-container">
Â  Â  Â  Â  <div id="wheel" class="wheel">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="pointer"></div>
Â  Â  Â  Â  <div class="center-button">Ğ¡ĞŸĞ˜Ğ</div>
Â  Â  </div>

Â  Â  <button id="spinButton" class="spin-button">
Â  Â  Â  Â  Ğ˜ÑĞ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒ Ğ£Ğ´Ğ°Ñ‡Ñƒ!
Â  Â  </button>

Â  Â  Â  Â  <div id="resultModal" class="modal" onclick="closeModal(true)">
Â  Â  Â  Â  <div class="modal-content" onclick="event.stopPropagation()">
Â  Â  Â  Â  Â  Â  <h2>ğŸ‰ ĞŸĞĞ—Ğ”Ğ ĞĞ’Ğ›Ğ¯Ğ•Ğœ! ğŸ‰</h2>
Â  Â  Â  Â  Â  Â  <p id="prizeText">Ğ’Ñ‹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ğ°Ğ»Ğ¸: </p>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size: 14px; margin-top: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ·Ğ° Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ½Ğ°ÑˆĞµĞ¼Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ:
Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  <a href="https://t.me/helpmeetmarket" target="_blank" class="modal-link" id="getPrizeLink">
Â  Â  Â  Â  Â  Â  Â  Â  ĞĞ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ ğŸ”¥
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button onclick="closeModal(true)" style="margin-top: 20px; background: #6c757d;">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>

<script>
// -----------------------------------------------------
// 1. ĞšĞĞĞ¤Ğ˜Ğ“Ğ£Ğ ĞĞ¦Ğ˜Ğ¯
// -----------------------------------------------------

const PRIZES = [
Â  Â  "ğŸ 6000 meet-Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²",
Â  Â  "ğŸ 5000 meet-Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²",
Â  Â  "ğŸ 4000 meet-Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²",
Â  Â  "ğŸ 3000 meet-Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²",
Â  Â  "ğŸ 2000 meet-Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²",
Â  Â  "ğŸ 1000 meet-Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ²",
Â  Â  "ğŸšš ĞŸÑ€Ğ¾Ğ¼Ğ¾ĞºĞ¾Ğ´ Ğ½Ğ° Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½ÑƒÑ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºÑƒ",
Â  Â  "ğŸ‘‘ Ğ¡ĞºĞ¸Ğ´ĞºĞ° 10% (Ğ¾Ñ‚ 20 000 â‚½)",
Â  Â  "ğŸ‘‘ Ğ¡ĞºĞ¸Ğ´ĞºĞ° 15% (Ğ¾Ñ‚ 25 000 â‚½)",
Â  Â  "ğŸ”¥ SoleFresh Ğº Ğ·Ğ°ĞºĞ°Ğ·Ñƒ"
];
const NUM_SECTORS = PRIZES.length;
const SECTOR_ANGLE = 360 / NUM_SECTORS; // 36 Ğ³Ñ€Ğ°Ğ´ÑƒÑĞ¾Ğ² Ğ½Ğ° ÑĞµĞºÑ‚Ğ¾Ñ€

// --- ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ«Ğ™ ĞŸĞ£Ğ‘Ğ›Ğ˜Ğ§ĞĞ«Ğ™ URL Ğ’ĞĞ¨Ğ•Ğ“Ğ Ğ‘Ğ­ĞšĞ•ĞĞ”Ğ ---
// ĞĞ´Ñ€ĞµÑ, Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ²Ğ°Ğ¼Ğ¸: https://meetslot-api-backend-production.up.railway.app/api
const API_BASE_URL = 'https://meetslot-api-backend-production.up.railway.app/api';

// Ğ¦Ğ²ĞµÑ‚Ğ° Ğ´Ğ»Ñ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ¾Ğ²
const SECTOR_COLORS = [
Â  Â  '#FF6347', '#FFD700', '#3CB371', '#4682B4', '#DA70D6',Â 
Â  Â  '#FFA07A', '#98FB98', '#ADD8E6', '#FF69B4', '#F4A460'
];


// -----------------------------------------------------
// 2. Ğ˜ĞĞ˜Ğ¦Ğ˜ĞĞ›Ğ˜Ğ—ĞĞ¦Ğ˜Ğ¯ Ğ˜ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢Ğ«
// -----------------------------------------------------

const wheel = document.getElementById('wheel');
const spinButton = document.getElementById('spinButton');
const resultModal = document.getElementById('resultModal');
const prizeText = document.getElementById('prizeText');
const errorText = document.getElementById('errorText');
const getPrizeLink = document.getElementById('getPrizeLink'); // ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚

let isSpinning = false;
let currentPrizeIndex = null;Â 

// -----------------------------------------------------
// 3. Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ UI / Ğ’Ğ—ĞĞ˜ĞœĞĞ”Ğ•Ğ™Ğ¡Ğ¢Ğ’Ğ˜Ğ¯
// -----------------------------------------------------

/**
Â * ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ğ± Ğ¾ÑˆĞ¸Ğ±ĞºĞµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ñ‚Ğ°Ğ¹Ğ¼ĞµÑ€ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ĞºĞ°Ğ· ÑĞµÑ‚Ğ¸)
Â * @param {string} message - Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
Â */
function showAppMessage(message) {
Â  Â  if (errorText) {
Â  Â  Â  Â  errorText.textContent = message;
Â  Â  Â  Â  errorText.style.display = 'block';
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  errorText.style.display = 'none';
Â  Â  Â  Â  Â  Â  errorText.textContent = '';
Â  Â  Â  Â  }, 5000);
Â  Â  } else {
Â  Â  Â  Â  console.error("ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞĞµ Ğ¼Ğ¾Ğ³Ñƒ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ, ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ #errorText Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚.");
Â  Â  }
}

function showModal(prize) {
Â  Â  if (resultModal && prizeText) {
Â  Â  Â  Â  prizeText.textContent = `Ğ’Ñ‹ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ğ°Ğ»Ğ¸: ${prize}`;
Â  Â  Â  Â  // Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ•: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑÑ‹Ğ»ĞºÑƒ Ğ² ĞºĞ½Ğ¾Ğ¿ĞºÑƒ (Ğ´Ğ»Ñ Telegram WebApp)
Â  Â  Â  Â  if (getPrizeLink) {
Â  Â  Â  Â  Â  Â  // Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ĞºÑ€ÑƒÑ‚Ğ¸Ğ», Ğ½Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ğ¸ Ğ½Ğ° ÑÑÑ‹Ğ»ĞºÑƒ
Â  Â  Â  Â  Â  Â  // Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°Ğ»Ğ¾ÑÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ WebApp.
Â  Â  Â  Â  Â  Â  getPrizeLink.onclick = () => {
Â  Â  Â  Â  Â  Â  Â  Â  // ĞœÑ‹ Ğ½Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ·Ğ´ĞµÑÑŒ, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ¿Ğ¾ ÑÑÑ‹Ğ»ĞºĞµ
Â  Â  Â  Â  Â  Â  Â  Â  // Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ WebApp, Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ°Ğ¼ Ğ²ĞµÑ€Ğ½ĞµÑ‚ÑÑ.
Â  Â  Â  Â  Â  Â  Â  Â  // ĞÑÑ‚Ğ°Ğ²Ğ¸Ğ¼ ĞµĞ³Ğ¾ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼, Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ resetWheel Ğ´Ğ»Ñ Ñ‡Ğ¸ÑÑ‚Ğ¾Ñ‚Ñ‹.
Â  Â  Â  Â  Â  Â  Â  Â  closeModal(true); // Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ¸ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ»ĞµÑĞ¾
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  Â  resultModal.style.display = 'block';
Â  Â  }
}

/**
Â * Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ¸ (ĞĞŸĞ¦Ğ˜ĞĞĞĞ›Ğ¬ĞĞ) ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ñ€ÑƒĞ»ĞµÑ‚ĞºÑƒ.
Â * @param {boolean} shouldResetWheel - ĞÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚ Ñ€ÑƒĞ»ĞµÑ‚ĞºĞ¸.
Â */
function closeModal(shouldResetWheel) {
Â  Â  if (resultModal) {
Â  Â  Â  Â  resultModal.style.display = 'none';
Â  Â  }
Â  Â Â 
Â  Â  // ĞĞ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°: ÑĞ±Ñ€Ğ¾Ñ Ñ€ÑƒĞ»ĞµÑ‚ĞºĞ¸
Â  Â  if (shouldResetWheel && wheel) {
Â  Â  Â  Â  wheel.style.transition = 'transform 0.5s ease-out';
Â  Â  Â  Â  wheel.style.transform = `rotate(0deg)`;
Â  Â  }
}

/**
Â * Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ° Ğ² ĞºĞ¾Ğ»ĞµÑĞ¾ Ñ€ÑƒĞ»ĞµÑ‚ĞºĞ¸.
Â */
function drawWheel() {
Â  Â  if (!wheel) return;
Â  Â  wheel.innerHTML = ''; // ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°
Â  Â Â 
Â  Â  for (let i = 0; i < NUM_SECTORS; i++) {
Â  Â  Â  Â  const sector = document.createElement('div');
Â  Â  Â  Â  sector.className = 'sector';
Â  Â  Â  Â  sector.style.backgroundColor = SECTOR_COLORS[i % SECTOR_COLORS.length];
Â  Â  Â  Â Â 
Â  Â  Â  Â  sector.style.transform = `rotate(${i * SECTOR_ANGLE}deg) skewY(${90 - SECTOR_ANGLE}deg)`;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const textContainer = document.createElement('div');
Â  Â  Â  Â  textContainer.className = 'sector-text';
Â  Â  Â  Â Â 
Â  Â  Â  Â  textContainer.style.transform = `skewY(-${90 - SECTOR_ANGLE}deg) rotate(90deg) translate(-50%, -50%)`;
Â  Â  Â  Â  textContainer.style.transformOrigin = '0 0';
Â  Â  Â  Â Â 
Â  Â  Â  Â  const textElement = document.createElement('span');
Â  Â  Â  Â  textElement.textContent = PRIZES[i];
Â  Â  Â  Â Â 
Â  Â  Â  Â  textContainer.appendChild(textElement);
Â  Â  Â  Â  sector.appendChild(textContainer);
Â  Â  Â  Â  wheel.appendChild(sector);
Â  Â  }
}

/**
Â * Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Telegram WebApp
Â */
function initTelegramApp() {
Â  Â  try {
Â  Â  Â  Â  if (window.Telegram && window.Telegram.WebApp) {
Â  Â  Â  Â  Â  Â  window.Telegram.WebApp.ready();
Â  Â  Â  Â  Â  Â  const Button = window.Telegram.WebApp.MainButton;
Â  Â  Â  Â  Â  Â  Button.setText("Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ€ÑƒĞ»ĞµÑ‚ĞºÑƒ");
Â  Â  Â  Â  Â  Â  Button.onClick(() => window.Telegram.WebApp.close());
Â  Â  Â  Â  Â  Â  Button.show();
Â  Â  Â  Â  Â  Â  console.log("Telegram WebApp Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾.");
Â  Â  Â  Â  }
Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Telegram WebApp. Ğ—Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ Ğ½Ğµ Ğ² Telegram.", e);
Â  Â  }
Â  Â  drawWheel();
}


// -----------------------------------------------------
// 4. Ğ›ĞĞ“Ğ˜ĞšĞ API
// -----------------------------------------------------

/**
Â * ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ½Ğ° Ğ±ÑĞºĞµĞ½Ğ´ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°.
Â * @returns {Promise<number|null>} Ğ˜Ğ½Ğ´ĞµĞºÑ ÑĞµĞºÑ‚Ğ¾Ñ€Ğ° Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ° Ğ¸Ğ»Ğ¸ null.
Â */
async function getSpinResultFromBackend() {
Â  Â  console.log(`Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° Ğ½Ğ° Ğ±ÑĞºĞµĞ½Ğ´: ${API_BASE_URL}/spin_check`);

Â  Â  if (!window.Telegram || !window.Telegram.WebApp || !window.Telegram.WebApp.initData) {
Â  Â  Â  Â  showAppMessage("ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ½Ğµ Ğ² Telegram WebApp Ğ¸Ğ»Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹.");
Â  Â  Â  Â  return null;
Â  Â  }

Â  Â  const initData = window.Telegram.WebApp.initData;
Â  Â  let userId = null;

Â  Â  // ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ user_id
Â  Â  try {
Â  Â  Â  Â  const urlParams = new URLSearchParams(initData);
Â  Â  Â  Â  const userParam = urlParams.get('user');
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (userParam) {
Â  Â  Â  Â  Â  Â  const decodedUser = decodeURIComponent(userParam);
Â  Â  Â  Â  Â  Â  const userData = JSON.parse(decodedUser);
Â  Â  Â  Â  Â  Â  userId = userData.id;Â 
Â  Â  Â  Â  }
Â  Â  } catch(e) {
Â  Â  Â  Â  console.error("ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ñ€Ğ°Ğ·Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ:", e);
Â  Â  Â  Â  showAppMessage("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ.");
Â  Â  Â  Â  return null;
Â  Â  }
Â  Â Â 
Â  Â  if (!userId) {
Â  Â  Â  Â  showAppMessage("ĞÑˆĞ¸Ğ±ĞºĞ°: ID Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Telegram.");
Â  Â  Â  Â  return null;
Â  Â  }


Â  Â  try {
Â  Â  Â  Â  const response = await fetch(`${API_BASE_URL}/spin_check`, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  body: JSON.stringify({ user_id: userId })
Â  Â  Â  Â  });

Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  let errorData = {};
Â  Â  Â  Â  Â  Â  let responseBody = '';

Â  Â  Â  Â  Â  Â  // 1. ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ĞºĞ°Ğº JSON
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  errorData = await response.json();Â 
Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  // Ğ•ÑĞ»Ğ¸ Ğ½Ğµ JSON, Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ ĞºĞ°Ğº Ñ‚ĞµĞºÑÑ‚
Â  Â  Â  Â  Â  Â  Â  Â  responseBody = await response.text();
Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ½Ğµ-JSON Ğ¾Ñ‚Ğ²ĞµÑ‚ (HTTP ${response.status}):`, responseBody);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ»Ğ¸ ÑÑ‚Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ½Ğµ Ğ²ĞµÑ€Ğ½ÑƒĞ» JSON
Â  Â  Â  Â  Â  Â  Â  Â  if (responseBody.includes('User already spun today')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showAppMessage('Ğ’Ñ‹ ÑƒĞ¶Ğµ ĞºÑ€ÑƒÑ‚Ğ¸Ğ»Ğ¸ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ! ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°.');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  showAppMessage(`ĞÑˆĞ¸Ğ±ĞºĞ°: CĞµÑ€Ğ²ĞµÑ€ Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ½ĞµĞ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ (HTTP ${response.status}).`);
Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 2. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° 403 (Ğ¢Ğ°Ğ¹Ğ¼ĞµÑ€) - (Ñ‚ĞµĞ¿ĞµÑ€ÑŒ errorData Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ JSON)
Â  Â  Â  Â  Â  Â  if (response.status === 403) {
Â  Â  Â  Â  Â  Â  Â  Â  if (errorData && errorData.next_spin_timestamp) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nextSpinTimestamp = errorData.next_spin_timestamp;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const nextSpinDate = new Date(nextSpinTimestamp * 1000);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeRemaining = nextSpinDate - new Date();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (timeRemaining > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hours = Math.floor(timeRemaining / (1000 * 60 * 60));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showAppMessage(`Ğ’Ñ‹ ÑƒĞ¶Ğµ ĞºÑ€ÑƒÑ‚Ğ¸Ğ»Ğ¸ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ! ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ Ñ‡ĞµÑ€ĞµĞ· ${hours} Ñ‡. ${minutes} Ğ¼.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // 3. ĞĞ±Ñ‰Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ±ÑĞºĞµĞ½Ğ´Ğ° (500, 400 Ğ¸ Ñ‚.Ğ´.)
Â  Â  Â  Â  Â  Â  showAppMessage(`ĞÑˆĞ¸Ğ±ĞºĞ°: ${errorData.message || 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ°'}`);
Â  Â  Â  Â  Â  Â  console.error(`API Error (${response.status}):`, errorData);
Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }


Â  Â  Â  Â  // Ğ•ÑĞ»Ğ¸ response.ok (ÑÑ‚Ğ°Ñ‚ÑƒÑ 200), Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ¸Ğ³Ñ€Ñ‹ÑˆĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ
Â  Â  Â  Â  const data = await response.json();Â 

Â  Â  Â  Â  if (typeof data.prize_index === 'number') {
Â  Â  Â  Â  Â  Â  return data.prize_index; // Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ¾Ñ‚ 0 Ğ´Ğ¾ 9
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  showAppMessage('ĞÑˆĞ¸Ğ±ĞºĞ°: Ğ‘ÑĞºĞµĞ½Ğ´ Ğ²ĞµÑ€Ğ½ÑƒĞ» ÑÑ‚Ğ°Ñ‚ÑƒÑ 200, Ğ½Ğ¾ Ğ½Ğµ Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¿Ñ€Ğ¸Ğ·Ğ°.');
Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }

Â  Â  } catch (e) {
Â  Â  Â  Â  // Ğ›Ğ¾Ğ²Ğ¸Ğ¼ Failed to fetch Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
Â  Â  Â  Â  if (e.message.includes('Failed to fetch')) {
Â  Â  Â  Â  Â  Â  Â showAppMessage("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ»Ğ¸ Ğ²Ğ°Ñˆ Ğ±ÑĞºĞµĞ½Ğ´ Ğ¸ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚ĞµĞ½ Ğ»Ğ¸ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ URL.");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â showAppMessage(`ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: ${e.message}. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ.`);
Â  Â  Â  Â  }
Â  Â  Â  Â  console.error("ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° fetch:", e);
Â  Â  Â  Â  return null;
Â  Â  }
}

// -----------------------------------------------------
// 5. Ğ›ĞĞ“Ğ˜ĞšĞ Ğ Ğ£Ğ›Ğ•Ğ¢ĞšĞ˜
// -----------------------------------------------------

/**
Â * Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ğ¾ Ğ½Ğ°Ğ¶Ğ°Ñ‚Ğ¸Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "Ğ˜ÑĞ¿Ñ‹Ñ‚Ğ°Ñ‚ÑŒ Ğ£Ğ´Ğ°Ñ‡Ñƒ!".
Â */
async function handleSpinClick() {
Â  Â  if (!spinButton) {
Â  Â  Â  Â  console.error("ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞ¿Ğ¸Ğ½Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°.");
Â  Â  Â  Â  showAppMessage("ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°: ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°.");
Â  Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  if (isSpinning) return;
Â  Â  isSpinning = true;
Â  Â  spinButton.disabled = true; // ĞÑ‚ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ÑÑ€Ğ°Ğ·Ñƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸ĞºĞ¾Ğ²
Â  Â Â 
Â  Â  if (errorText) {
Â  Â  Â  Â  errorText.style.display = 'none';
Â  Â  }

Â  Â  const winningIndex = await getSpinResultFromBackend();

Â  Â  if (winningIndex === null) {
Â  Â  Â  Â  // ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°.
Â  Â  Â  Â  isSpinning = false;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Ğ’ĞĞ–ĞĞĞ•: Ğ•ÑĞ»Ğ¸ showAppMessage Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ» ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ğµ, Ğ¼Ñ‹ Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ disabled.
Â  Â  Â  Â  // Ğ˜Ğ½Ğ°Ñ‡Ğµ (Ğ»ÑĞ±Ğ°Ñ Ğ´Ñ€ÑƒĞ³Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°) - Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾.
Â  Â  Â  Â  if (errorText && !errorText.textContent.includes('ĞºÑ€ÑƒÑ‚Ğ¸Ğ»Ğ¸ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ')) {
Â  Â  Â  Â  Â  Â  Â spinButton.disabled = false;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑĞ»ÑƒÑ‡Ğ°Ğ¹, ĞµÑĞ»Ğ¸ errorText Ğ½Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚
Â  Â  Â  Â  if (!errorText && spinButton) {
Â  Â  Â  Â  Â  Â  Â spinButton.disabled = false;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  return;
Â  Â  }

Â  Â  // --- Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ«Ğ™ Ğ¡ĞŸĞ˜Ğ ---
Â  Â  currentPrizeIndex = winningIndex;Â 

Â  Â  const baseRotations = 5;Â 
Â  Â  const degreesToWin = (NUM_SECTORS - winningIndex - 0.5) * SECTOR_ANGLE;

Â  Â  const finalRotation = (baseRotations * 360) + degreesToWin;

Â  Â  if (wheel) {
Â  Â  Â  Â  // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğ¹ transition Ğ´Ğ»Ñ Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ±Ñ€Ğ¾ÑĞ°
Â  Â  Â  Â  wheel.style.transition = 'none';
Â  Â  Â  Â  // Ğ¡Ğ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµĞ¼ ĞµĞµ Ğ¿ĞµÑ€ĞµĞ´ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾Ğ¼ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ
Â  Â  Â  Â  wheel.style.transform = 'rotate(0deg)';Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // ĞĞ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµĞ¼, Ñ‡Ñ‚Ğ¾ transition Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğº Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ
Â  Â  Â  Â  // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ setTimeout 0 Ğ´Ğ»Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ¸Ğ»ĞµĞ¹
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  wheel.style.transition = 'transform 5s cubic-bezier(0.2, 0.8, 0.2, 1)';
Â  Â  Â  Â  Â  Â  wheel.style.transform = `rotate(${finalRotation}deg)`;

Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  const prize = PRIZES[currentPrizeIndex];
Â  Â  Â  Â  Â  Â  Â  Â  showModal(prize);

Â  Â  Â  Â  Â  Â  Â  Â  isSpinning = false;
Â  Â  Â  Â  Â  Â  Â  Â  // ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ disabled, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼Ñƒ Ñ‡Ñ‚Ğ¾ ÑĞ¿Ğ¸Ğ½ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½
Â  Â  Â  Â  Â  Â  }, 5500);Â 
Â  Â  Â  Â  }, 50); // ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑĞ±Ñ€Ğ¾ÑĞ°
Â  Â  } else {
Â  Â  Â  Â  const prize = PRIZES[currentPrizeIndex];
Â  Â  Â  Â  showModal(prize);
Â  Â  Â  Â  isSpinning = false;
Â  Â  }
}

// ĞŸÑ€Ğ¸Ğ²ÑĞ·ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ° Ğº ĞºĞ½Ğ¾Ğ¿ĞºĞµ
if (spinButton) {
Â  Â  spinButton.addEventListener('click', handleSpinClick);
}

// Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
window.onload = initTelegramApp;
</script>
</body>
</html>
